<ion-header>
  <ion-toolbar color="primary">
    <ion-title>MakePizza</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="goToCart()">
        <ion-icon name="cart-outline"></ion-icon>
        <ion-badge *ngIf="cartItemCount > 0" color="danger">{{cartItemCount}}</ion-badge>
      </ion-button>
      <ion-button routerLink="/profile">
        <ion-icon name="person-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Botón destacado para crear pizza personalizada -->
  <ion-card color="secondary" button (click)="goToCustomPizza()">
    <ion-card-content class="ion-text-center">
      <ion-icon name="add-circle-outline" size="large"></ion-icon>
      <h2><strong>Crea Tu Pizza Personalizada</strong></h2>
      <p>Elige tus ingredientes favoritos</p>
    </ion-card-content>
  </ion-card>

  <!-- Pizzas Populares -->
  <div *ngIf="popularPizzas.length > 0" class="section">
    <ion-list-header>
      <ion-label>
        <h2><strong>Pizzas Populares</strong></h2>
      </ion-label>
    </ion-list-header>

    <ion-slides [options]="{ slidesPerView: 1.2, spaceBetween: 10 }" *ngIf="popularPizzas.length > 0">
      <ion-slide *ngFor="let pizza of popularPizzas">
        <ion-card button (click)="viewPizzaDetail(pizza)" class="pizza-card">
          <img [src]="pizza.imageUrl" [alt]="pizza.name" onerror="this.src='assets/placeholder-pizza.jpg'">
          <ion-card-header>
            <ion-card-subtitle>{{pizza.category}}</ion-card-subtitle>
            <ion-card-title>{{pizza.name}}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p class="description">{{pizza.description}}</p>
            <div class="price-action">
              <h3>Desde ${{pizza.basePrice.toFixed(2)}}</h3>
              <ion-button fill="solid" color="primary" (click)="addToCart(pizza, $event)">
                <ion-icon name="add" slot="start"></ion-icon>
                Agregar
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-slide>
    </ion-slides>
  </div>

  <!-- Filtros por categoría -->
  <ion-segment [(ngModel)]="selectedCategory" (ionChange)="filterByCategory($event.detail.value!)" scrollable>
    <ion-segment-button *ngFor="let category of categories" [value]="category">
      <ion-label>{{category}}</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Lista de todas las pizzas -->
  <div class="section">
    <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>

    <ion-grid *ngIf="!loading">
      <ion-row>
        <ion-col *ngFor="let pizza of filteredPizzas" size="12" size-md="6" size-lg="4">
          <ion-card button (click)="viewPizzaDetail(pizza)" class="pizza-card">
            <img [src]="pizza.imageUrl" [alt]="pizza.name" onerror="this.src='assets/placeholder-pizza.jpg'">
            <ion-badge *ngIf="pizza.popular" color="warning" class="popular-badge">Popular</ion-badge>
            <ion-card-header>
              <ion-card-subtitle>{{pizza.category}}</ion-card-subtitle>
              <ion-card-title>{{pizza.name}}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p class="description">{{pizza.description}}</p>
              <div class="price-action">
                <h3>Desde ${{pizza.basePrice.toFixed(2)}}</h3>
                <ion-button fill="solid" color="primary" (click)="addToCart(pizza, $event)">
                  <ion-icon name="add" slot="start"></ion-icon>
                  Agregar
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <div *ngIf="!loading && filteredPizzas.length === 0" class="empty-state">
      <ion-icon name="pizza-outline" size="large" color="medium"></ion-icon>
      <p>No hay pizzas en esta categoría</p>
    </div>
  </div>

  <!-- Acceso rápido a bebidas -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button routerLink="/drinks">
      <ion-icon name="beer-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
